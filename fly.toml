# fly.toml
# Nome do aplicativo registrado no Fly.io
app = "tammyclara-store-b2y" 

# Regiﾃ｣o primﾃ｡ria para a mﾃ｡quina virtual
primary_region = "gru"

[build]
  # Usa o Dockerfile na raiz

# 圷 CONFIGURAﾃﾃグ DE VOLUMES: UNIFICADA PARA 1 VOLUME (LIMITE DO PLANO GRATUITO) 圷
[[mounts]]
  # O volume ﾃｺnico que armazena tanto o db.sqlite3 quanto a pasta /media
  source="tammyclara_data" 
  destination="/app/data"   # O ponto de montagem no contﾃｪiner

[env]
  PORT = "8000"
  PYTHON_VERSION = "3.11"

# Configuraﾃｧﾃ｣o para servir a aplicaﾃｧﾃ｣o Web
[[services]]
  protocol = "tcp"
  internal_port = 8000
  processes = ["app"]

  [[services.ports]]
    port = "80"
    handlers = ["http"]
    force_https = true

  [[services.ports]]
    port = "443"
    handlers = ["tls", "http"]

  [[services.http_checks]]
    interval = "10s"
    grace_period = "5s"
    # Rota estﾃ｡vel para o health check
    path = "/admin/login/" 
    # 笨 CORREﾃﾃグ: Aumentado de 2s para 5s para evitar timeout de inicializaﾃｧﾃ｣o do Django.
    timeout = "5s" 
    # 笨 CORREﾃﾃグ: Formato correto do campo.
    tls-skip-verify = false 
    
[deploy]
  # 笨 CORREﾃﾃグ CRﾃ控ICA: Usa /bin/sh -c para executar comandos encadeados.
  release_command = "/bin/sh -c 'python manage.py collectstatic --noinput && python manage.py migrate --noinput'"