# fly.toml
app = "tammyclara-store-b2y" 
primary_region = "gru"

[build]
  # Configura√ß√µes de build (usando o Dockerfile)
  
[env]
  PORT = "8000"
  PYTHON_VERSION = "3.11"

# üö® CORRE√á√ÉO CR√çTICA: [[mounts]] para m√∫ltiplos volumes üö®

[[mounts]]
  # 1. VOLUME PARA O BANCO DE DADOS SQLITE
  source="tammyclara_db" 
  destination="/app/db"   # Ponto de montagem para o banco de dados

[[mounts]]
  # 2. VOLUME PARA ARQUIVOS DE M√çDIA
  source="tammyclara_media" 
  destination="/app/media"  # Ponto de montagem para as imagens de produtos

# Configura√ß√£o para servir a aplica√ß√£o Web
[[services]]
  protocol = "tcp"
  internal_port = 8000
  processes = ["app"]

  [[services.ports]]
    port = "80"
    handlers = ["http"]
    force_https = true

  [[services.ports]]
    port = "443"
    handlers = ["tls", "http"]

  [[services.http_checks]]
    interval = "10s"
    grace_period = "5s"
    path = "/admin/"
    timeout = "2s"
    tls_skip_verify = false

[deploy]
  # Comando que roda as migra√ß√µes ANTES de iniciar a aplica√ß√£o
  release_command = "python manage.py migrate --noinput"